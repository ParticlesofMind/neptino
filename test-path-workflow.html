<!DOCTYPE html>
<html>
<head>
    <title>Path Tool Workflow Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .step { margin: 10px 0; }
        button { margin: 5px; padding: 10px; }
        .status { font-weight: bold; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Path Tool Workflow Test</h1>
    
    <div class="test-section">
        <h2>Step 1: Initialize Canvas</h2>
        <button onclick="initializeTest()">Initialize Test Environment</button>
        <div id="init-status" class="status"></div>
    </div>
    
    <div class="test-section">
        <h2>Step 2: Create Scene</h2>
        <button onclick="createTestScene()">Create Test Scene</button>
        <div id="scene-status" class="status"></div>
    </div>
    
    <div class="test-section">
        <h2>Step 3: Add Test Object</h2>
        <button onclick="addTestObject()">Add Text Object</button>
        <div id="object-status" class="status"></div>
    </div>
    
    <div class="test-section">
        <h2>Step 4: Test Path Tool</h2>
        <button onclick="testPathTool()">Switch to Path Tool</button>
        <div id="path-status" class="status"></div>
        <p><em>After clicking "Switch to Path Tool", try clicking and dragging the text object within the scene!</em></p>
    </div>
    
    <div class="test-section">
        <h2>Debug Info</h2>
        <button onclick="showDebugInfo()">Show Debug Info</button>
        <div id="debug-info"></div>
    </div>
    
    <script>
        let testScene = null;
        let testObject = null;
        
        function updateStatus(elementId, message, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'status ' + (isSuccess ? 'success' : 'error');
        }
        
        function initializeTest() {
            if (!window.canvasAPI || !window.toolStateManager) {
                updateStatus('init-status', 'Canvas API not ready - please wait and try again', false);
                return;
            }
            
            // Switch to animate mode
            window.toolStateManager.setMode('animate');
            updateStatus('init-status', 'Canvas initialized and switched to animate mode');
        }
        
        function createTestScene() {
            if (!window.toolStateManager) {
                updateStatus('scene-status', 'Tool manager not available', false);
                return;
            }
            
            // Switch to scene tool
            window.toolStateManager.setTool('scene');
            
            // Create a test scene programmatically
            const { Scene } = window;
            if (Scene) {
                const bounds = { x: 100, y: 100, width: 400, height: 300 };
                testScene = new Scene(bounds);
                updateStatus('scene-status', 'Test scene created at (100, 100) with size 400x300');
            } else {
                updateStatus('scene-status', 'Scene class not available - create scene manually with scene tool', false);
            }
        }
        
        function addTestObject() {
            if (!window.canvasAPI) {
                updateStatus('object-status', 'Canvas API not available', false);
                return;
            }
            
            // Switch to text tool and create a text object
            window.toolStateManager.setTool('text');
            
            // Get the drawing layer and add a text object directly
            const drawingLayer = window.canvasAPI.getDrawingLayer();
            if (drawingLayer && window.PIXI) {
                testObject = new window.PIXI.Text('Test Object', {
                    fontSize: 24,
                    fill: 0x000000
                });
                testObject.position.set(200, 200); // Position within our test scene
                testObject.name = 'TestObject';
                testObject.objectId = 'test-object-' + Date.now();
                
                drawingLayer.addChild(testObject);
                updateStatus('object-status', 'Test text object added at (200, 200)');
            } else {
                updateStatus('object-status', 'Could not create test object - PIXI not available', false);
            }
        }
        
        function testPathTool() {
            if (!window.toolStateManager) {
                updateStatus('path-status', 'Tool manager not available', false);
                return;
            }
            
            // Switch to path tool
            window.toolStateManager.setTool('path');
            updateStatus('path-status', 'Switched to path tool - try dragging the test object!');
        }
        
        function showDebugInfo() {
            let info = '<h3>Debug Information</h3>';
            
            // Check canvas API
            info += '<p><strong>Canvas API:</strong> ' + (window.canvasAPI ? 'Available' : 'Not available') + '</p>';
            
            // Check tool state manager
            info += '<p><strong>Tool State Manager:</strong> ' + (window.toolStateManager ? 'Available' : 'Not available') + '</p>';
            
            // Check current mode and tool
            if (window.toolStateManager) {
                info += '<p><strong>Current Mode:</strong> ' + window.toolStateManager.getCurrentMode() + '</p>';
                info += '<p><strong>Current Tool:</strong> ' + window.toolStateManager.getCurrentTool() + '</p>';
            }
            
            // Check animation state
            if (window.animationState) {
                const scenes = window.animationState.getScenes();
                info += '<p><strong>Scenes:</strong> ' + scenes.length + '</p>';
                
                scenes.forEach((scene, index) => {
                    const contentContainer = scene.getContentContainer();
                    info += '<p><strong>Scene ' + (index + 1) + ':</strong> ' + scene.getId() + ' (' + contentContainer.children.length + ' objects)</p>';
                });
            }
            
            // Check drawing layer objects
            if (window.canvasAPI) {
                const drawingLayer = window.canvasAPI.getDrawingLayer();
                if (drawingLayer) {
                    info += '<p><strong>Drawing Layer Objects:</strong> ' + drawingLayer.children.length + '</p>';
                }
            }
            
            document.getElementById('debug-info').innerHTML = info;
        }
        
        // Auto-initialize after a delay
        setTimeout(() => {
            if (window.canvasAPI && window.toolStateManager) {
                initializeTest();
            }
        }, 2000);
        
    </script>
</body>
</html>