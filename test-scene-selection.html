<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scene Selection Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
        }
        #canvas-container {
            border: 1px solid #333;
            background-color: #2a2a2a;
            width: 100%;
            height: 600px;
            position: relative;
            overflow: hidden;
        }
        .instructions {
            margin-bottom: 20px;
            line-height: 1.5;
        }
        .tool-buttons {
            margin-bottom: 20px;
        }
        .tool-buttons button {
            margin-right: 10px;
            padding: 8px 16px;
            background-color: #333;
            color: white;
            border: 1px solid #555;
            cursor: pointer;
        }
        .tool-buttons button.active {
            background-color: #4a79a4;
        }
    </style>
</head>
<body>
    <div class="instructions">
        <strong>Scene Selection Test:</strong><br>
        1. Click "Scene Tool" and drag to create an animation scene<br>
        2. Switch to "Selection Tool"<br>
        3. Click on the scene - it should show blue anchor points and full border<br>
        4. Click outside the scene - only a subtle gray border should remain<br>
        5. Selected scenes should be movable and deletable with Backspace/Delete
    </div>
    
    <div class="tool-buttons">
        <button id="scene-tool">Scene Tool</button>
        <button id="selection-tool" class="active">Selection Tool</button>
    </div>
    
    <div id="canvas-container"></div>

    <script type="module">
        import { Application } from './node_modules/pixi.js/dist/pixi.mjs';
        import { animationState } from './src/scripts/coursebuilder/animation/AnimationState.js';
        import { SceneTool } from './src/scripts/coursebuilder/animation/tools/SceneTool.js';
        import { SelectionTool } from './src/scripts/coursebuilder/tools/selection/SelectionTool.js';
        import { ToolManager } from './src/scripts/coursebuilder/tools/ToolManager.js';

        // Create PIXI application
        const app = new Application();
        await app.init({
            width: 1200,
            height: 600,
            backgroundColor: 0x2a2a2a,
            antialias: true
        });

        const container = document.getElementById('canvas-container');
        container.appendChild(app.canvas);

        // Initialize animation state
        animationState.init(app.stage, app.stage);

        // Create tools
        const toolManager = new ToolManager();
        const sceneTool = new SceneTool(toolManager);
        const selectionTool = new SelectionTool();

        // Set up display object manager for selection tool
        const displayManager = {
            getRoot: () => app.stage,
            add: (obj) => app.stage.addChild(obj),
            remove: (obj) => obj.parent?.removeChild(obj)
        };
        selectionTool.setDisplayObjectManager(displayManager);
        selectionTool.setUILayer(app.stage);

        // Tool state
        let activeTool = selectionTool;
        selectionTool.activate();

        // Handle pointer events
        app.stage.eventMode = 'static';
        app.stage.on('pointerdown', (event) => {
            if (activeTool) {
                activeTool.onPointerDown(event, app.stage);
            }
        });

        app.stage.on('pointermove', (event) => {
            if (activeTool) {
                activeTool.onPointerMove(event, app.stage);
            }
        });

        app.stage.on('pointerup', (event) => {
            if (activeTool) {
                activeTool.onPointerUp(event, app.stage);
            }
        });

        // Handle keyboard events
        document.addEventListener('keydown', (event) => {
            if (activeTool && activeTool.onKeyDown) {
                activeTool.onKeyDown(event);
            }
        });

        // Tool switching
        document.getElementById('scene-tool').addEventListener('click', () => {
            if (activeTool) activeTool.deactivate();
            activeTool = sceneTool;
            sceneTool.activate();
            
            document.querySelectorAll('.tool-buttons button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('scene-tool').classList.add('active');
        });

        document.getElementById('selection-tool').addEventListener('click', () => {
            if (activeTool) activeTool.deactivate();
            activeTool = selectionTool;
            selectionTool.activate();
            
            document.querySelectorAll('.tool-buttons button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('selection-tool').classList.add('active');
        });

        console.log('Scene selection test initialized');
    </script>
</body>
</html>
</script>
</body>
</html>