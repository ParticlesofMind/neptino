<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Dimension Analysis</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .results { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .highlight { background: yellow; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Canvas Dimension Analysis</h1>
    <button onclick="analyzeCanvas()">Analyze Canvas Dimensions</button>
    <button onclick="analyzeMargins()">Analyze Blue Margins</button>
    <button onclick="testPixelAccuracy()">Test Pixel Accuracy</button>
    
    <div id="results"></div>

    <script>
        function log(message, className = '') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `results ${className}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        function analyzeCanvas() {
            log('<h3>üîç Canvas Analysis (Using Console Script)</h3>');
            
            // Open coursebuilder page and inject our analysis script
            const popup = window.open('http://localhost:3001/src/pages/teacher/coursebuilder.html#create', 'canvasTest', 'width=1400,height=800');
            
            setTimeout(() => {
                try {
                    // Inject our analysis script
                    const script = popup.document.createElement('script');
                    script.src = '/canvas-analysis.js';
                    popup.document.head.appendChild(script);
                    
                    log('‚úÖ Analysis script injected into coursebuilder page. Check the browser console for detailed output.', 'success');
                    
                    // Keep the popup open for manual inspection
                    log('üìù The popup window will remain open for manual inspection. Check the console in that window for detailed analysis.', 'highlight');
                    
                } catch (error) {
                    log(`‚ùå Error injecting analysis script: ${error.message}`, 'error');
                    popup.close();
                }
            }, 2000);
        }

        function analyzeMargins() {
            log('<h3>üîµ Blue Margin Analysis</h3>');
            
            const popup = window.open('http://localhost:3001/src/pages/teacher/coursebuilder.html#create', 'marginTest', 'width=1400,height=800');
            
            setTimeout(() => {
                try {
                    // Look for blue margin graphics
                    const canvas = popup.document.querySelector('#pixi-canvas');
                    
                    if (!canvas) {
                        log('‚ùå Canvas not found for margin analysis', 'error');
                        popup.close();
                        return;
                    }

                    // Access PIXI app and look for margin graphics
                    const canvasAPI = popup.window.canvasAPI;
                    const marginManager = popup.window.canvasMarginManager;
                    
                    if (canvasAPI) {
                        const app = canvasAPI.getApp();
                        if (app && app.stage) {
                            log(`‚úÖ PIXI App found with stage`);
                            
                            // Try to find margin graphics
                            let marginGraphics = null;
                            app.stage.children.forEach((layer, index) => {
                                if (layer.children) {
                                    layer.children.forEach(child => {
                                        if (child.label === 'blue-margin-lines') {
                                            marginGraphics = child;
                                        }
                                    });
                                }
                            });
                            
                            if (marginGraphics) {
                                log(`‚úÖ Found blue margin graphics!`);
                                log(`‚Ä¢ Graphics position: ${marginGraphics.x}, ${marginGraphics.y}`);
                                log(`‚Ä¢ Graphics bounds: ${marginGraphics.getBounds().width.toFixed(2)} √ó ${marginGraphics.getBounds().height.toFixed(2)}`);
                                log(`‚Ä¢ Graphics visible: ${marginGraphics.visible}`);
                                log(`‚Ä¢ Graphics alpha: ${marginGraphics.alpha}`);
                            } else {
                                log('‚ùå Blue margin graphics not found', 'error');
                            }
                        }
                    }
                    
                    if (marginManager) {
                        const margins = marginManager.getMargins();
                        log(`
                            <h4>üìè Current Margins (in pixels):</h4>
                            ‚Ä¢ Top: ${margins.top}px<br>
                            ‚Ä¢ Right: ${margins.right}px<br>
                            ‚Ä¢ Bottom: ${margins.bottom}px<br>
                            ‚Ä¢ Left: ${margins.left}px
                        `);
                        
                        // Calculate the content area
                        const canvasWidth = canvas.width;
                        const canvasHeight = canvas.height;
                        const contentWidth = canvasWidth - margins.left - margins.right;
                        const contentHeight = canvasHeight - margins.top - margins.bottom;
                        
                        log(`
                            <h4>üìê Content Area (inside margins):</h4>
                            ‚Ä¢ Canvas: ${canvasWidth} √ó ${canvasHeight}<br>
                            ‚Ä¢ Content: ${contentWidth} √ó ${contentHeight}<br>
                            ‚Ä¢ Content area percentage: ${((contentWidth * contentHeight) / (canvasWidth * canvasHeight) * 100).toFixed(1)}%
                        `, 'highlight');
                    }
                    
                    popup.close();
                    
                } catch (error) {
                    log(`‚ùå Error analyzing margins: ${error.message}`, 'error');
                    popup.close();
                }
            }, 3000); // Wait longer for canvas initialization
        }

        function testPixelAccuracy() {
            log('<h3>üéØ Pixel Accuracy Test</h3>');
            
            const popup = window.open('http://localhost:3001/src/pages/teacher/coursebuilder.html#create', 'pixelTest', 'width=1400,height=800');
            
            setTimeout(() => {
                try {
                    const canvas = popup.document.querySelector('#pixi-canvas');
                    
                    if (!canvas) {
                        log('‚ùå Canvas not found for pixel test', 'error');
                        popup.close();
                        return;
                    }

                    // Test if 1200x1800 pixels actually covers that area
                    const canvasRect = canvas.getBoundingClientRect();
                    const dpr = popup.devicePixelRatio;
                    
                    log(`
                        <h4>üîç Pixel Coverage Analysis:</h4>
                        ‚Ä¢ Canvas HTML size: ${canvas.width} √ó ${canvas.height}<br>
                        ‚Ä¢ Canvas CSS size: ${canvasRect.width.toFixed(2)} √ó ${canvasRect.height.toFixed(2)}<br>
                        ‚Ä¢ Device pixel ratio: ${dpr}<br>
                        ‚Ä¢ Effective pixels: ${(canvas.width * dpr).toFixed(0)} √ó ${(canvas.height * dpr).toFixed(0)}
                    `);
                    
                    // Calculate if this matches the claimed 1200x1800
                    const actualPixelArea = canvas.width * canvas.height;
                    const expectedPixelArea = 1200 * 1800;
                    const match = Math.abs(actualPixelArea - expectedPixelArea) / expectedPixelArea < 0.1; // Within 10%
                    
                    log(`
                        <h4>üìä Area Comparison:</h4>
                        ‚Ä¢ Expected area: ${expectedPixelArea.toLocaleString()} pixels<br>
                        ‚Ä¢ Actual area: ${actualPixelArea.toLocaleString()} pixels<br>
                        ‚Ä¢ Match: ${match ? '‚úÖ Yes (within 10%)' : '‚ùå No'}
                    `, match ? 'success' : 'error');
                    
                    popup.close();
                    
                } catch (error) {
                    log(`‚ùå Error in pixel test: ${error.message}`, 'error');
                    popup.close();
                }
            }, 2000);
        }
    </script>
</body>
</html>