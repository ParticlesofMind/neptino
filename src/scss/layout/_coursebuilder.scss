// ==========================================================================
// COURSEBUILDER LAYOUT
// ==========================================================================

.coursebuilder {
    &__setup[aria-hidden='true'],
    &__create[aria-hidden='true'],
    &__preview[aria-hidden='true'],
    &__launch[aria-hidden='true'] {
        display: none;
        visibility: hidden;
    }

    &__create {
        display: grid;
        grid-template-rows: minmax(0, 1fr);
        height: 100%;
        max-height: 100%;
        overflow: hidden;
        width: 100%;
    }

    &__setup {
        display: grid;
        grid-template-columns: clamp(13rem, 15vw, 16rem) minmax(0, 1fr);
        grid-template-rows: minmax(0, 1fr);
        gap: 2rem;
        height: 100%;
        max-height: 100%;
        overflow: hidden;

        container-type: inline-size;
        container-name: coursebuilder-setup;
    }

    &__aside {
        position: sticky;
        top: 0;
        align-self: start;
        height: 100vh;
        max-height: 100vh;
        padding-bottom: var(--spacing-4);
        box-sizing: border-box;
        overflow-y: auto;
        overflow-x: hidden;
    }

    &__setup article[data-course-section] {
        display: none;
        grid-template-columns: minmax(0, 1fr);
        grid-template-rows: auto minmax(0, 1fr) auto;
        gap: 0;
        align-content: stretch;
        align-items: stretch;
        justify-items: stretch;
        padding: 0;
        background: white;
        min-height: 0;
        height: 100%;
        overflow: hidden;
        box-sizing: border-box;
    }

    &__setup article[data-course-section].is-active {
        display: grid;
    }

    &__setup article[data-course-section] .form {
        width: 100%;
        margin: 0;
        padding: clamp(var(--spacing-2), 1.25vw, var(--spacing-3));
        box-shadow: none;
        background: transparent;
        display: grid;
        gap: var(--spacing-3);
        align-content: start;
    }

    &__setup .article__actions {
        display: grid;
        grid-auto-flow: column;
        grid-auto-columns: max-content;
        align-items: center;
        justify-content: start;
        gap: var(--spacing-3);
    }

    &__panel {
        display: grid;
        gap: var(--spacing-3);
        align-content: start;
        padding: clamp(var(--spacing-3), 1.5vw, var(--spacing-4));
        background: rgba(var(--color-background-rgb), 0.94);
        border: 1px solid rgba(15, 23, 42, 0.08);
        border-radius: var(--radius-small);
    }

    &__panel-title {
        margin: 0;
    }

    &__status {
        margin: 0;
        font-size: var(--font-size-small);
        color: var(--color-text-secondary);
    }
}

@container coursebuilder-setup (max-width: 58rem) {
    .coursebuilder__setup {
        grid-template-columns: minmax(0, 1fr);
    }
}

.placeholder {
    margin: 0;
    padding: var(--spacing-5);
    color: var(--color-neutral-500);
    text-align: center;
    font-style: italic;
}

.article__config,
.article__preview {
    background: white;
    border-right: 1px solid var(--color-neutral-200);
    height: 100%;
    padding: var(--spacing-4);
    align-self: stretch;
    width: 100%;
    min-height: 0;
    overflow-y: auto;
    overflow-x: hidden;
}

.article__preview {
    border-right: none;
}

.article__config {
    display: grid;
    gap: var(--spacing-4);
    align-content: start;
    min-width: 0;
    // Ensure config section is scrollable when content is large
    max-height: 100%;
}

.article__preview {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-4);
    justify-content: flex-start;
    // Ensure preview section is scrollable when content is large
    max-height: 100%;
}

.article[data-course-section]>.form {
    background: white;
    padding: var(--spacing-4);
    display: grid;
    gap: var(--spacing-4);
    align-content: start;
    width: 100%;
    align-self: stretch;
    min-height: 0;
    overflow-y: auto;
}

.article[data-course-section]>.form .form__label {
    gap: var(--spacing-2);
}

.article[data-course-section]>.placeholder {
    background: white;
    padding: var(--spacing-4);
    align-self: stretch;
    min-height: 0;
    overflow-y: auto;
}

// Responsive adjustments for split-screen sections
@media (max-width: 48rem) {
    .article__config,
    .article__preview {
        height: auto;
        min-height: 300px;
    }

    .article__config,
    .article__preview,
    .article[data-course-section]>.form {
        min-height: auto;
    }
}

.article--templates .article__config,
.article--templates .article__preview {
    min-height: 0;
    height: 100%;
    overflow-y: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
    scrollbar-color: var(--color-neutral-300) transparent;

    &::-webkit-scrollbar {
        width: 0.5rem;
    }

    &::-webkit-scrollbar-track {
        background: transparent;
    }

    &::-webkit-scrollbar-thumb {
        background: var(--color-neutral-300);
        border-radius: var(--radius-small);
    }

    &::-webkit-scrollbar-thumb:hover {
        background: var(--color-neutral-400);
    }
}

.article--templates {
    grid-template-rows: auto minmax(0, 1fr) minmax(0, 1fr);
    min-height: 0;
}

.article--templates .article__config,
.article--templates .article__preview {
    align-self: stretch;
}

.article--templates .article__config p,
.article--templates .article__preview p {
    color: var(--color-text-secondary);
    margin: 0;
}

.article--schedule .article__config {
    gap: var(--spacing-4);
}

.article--schedule .form--schedule {
    display: grid;
    gap: var(--spacing-3);
    grid-template-columns: repeat(auto-fit, minmax(14rem, 1fr));
    align-content: start;
}

.article--schedule .form--schedule>.schedule__days,
.article--schedule .form--schedule>.schedule__actions {
    grid-column: 1 / -1;
}

.article--schedule .form--schedule>.form__label {
    display: grid;
    gap: var(--spacing-2);
}

.article--schedule .schedule__days {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-2);
    padding: var(--spacing-3);
    background: var(--color-background);
    border: 1px dashed var(--color-neutral-200);
    border-radius: var(--radius-large);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
}

.article--schedule .schedule__days legend {
    font-weight: var(--font-weight-medium);
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-2);
    width: 100%;
}

.article--schedule .schedule__actions {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-3);
    justify-content: flex-end;
}

.article--schedule .article__preview {
    justify-content: flex-start;
}

.article--schedule .schedule__preview {
    display: grid;
    gap: var(--spacing-3);
    align-content: start;
    padding: var(--spacing-4);
    background: var(--color-background);
    border-radius: var(--radius-large);
    border: 1px solid var(--color-neutral-200);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
    height: 100%;
}

.article--schedule .schedule__content {
    display: grid;
    gap: var(--spacing-3);
    align-content: start;
}

.article--schedule .schedule__content--empty {
    min-height: 12rem;
    place-content: center;
    text-align: center;
    color: var(--color-text-tertiary);
}

.article--schedule .schedule__preview--empty {
    border-style: dashed;
    border-color: var(--color-neutral-200);
}

.article--schedule .schedule__placeholder,
.article--schedule .schedule__placeholder p {
    margin: 0;
}

.article--schedule .schedule__row {
    display: grid;
    grid-template-areas: "number day start end actions";
    grid-template-columns: minmax(3rem, auto) minmax(8rem, 1.2fr) minmax(8rem, 1fr) minmax(8rem, 1fr) auto;
    gap: var(--spacing-3);
    padding: var(--spacing-3);
    border: 1px solid var(--color-neutral-200);
    border-radius: var(--radius-medium);
    background: var(--color-neutral-50, #f9fafb);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.7);
    align-items: center;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.article--schedule .schedule__row:hover {
    border-color: var(--color-primary-200);
    box-shadow: 0 6px 18px rgba(46, 125, 249, 0.12);
}

.article--schedule .schedule__cell {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-1);
    min-width: 0;
}

.article--schedule .schedule__cell--number {
    grid-area: number;
    align-items: center;
    justify-content: center;
}

.article--schedule .schedule__cell--day {
    grid-area: day;
}

.article--schedule .schedule__cell--start {
    grid-area: start;
}

.article--schedule .schedule__cell--end {
    grid-area: end;
}

.article--schedule .schedule__cell--actions {
    grid-area: actions;
    display: flex;
    justify-content: flex-end;
    align-items: center;
}

.article--schedule .schedule__cell--time {
    gap: var(--spacing-2);
}

.article--schedule .schedule__field-label {
    font-size: var(--font-size-extra-small);
    font-weight: var(--font-weight-semibold);
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--color-text-tertiary);
}

.article--schedule .schedule__day {
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
}

.article--schedule .schedule__date {
    font-size: var(--font-size-small);
    color: var(--color-text-secondary);
}

.article--schedule .schedule__badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 999px;
    background: var(--color-primary-100);
    color: var(--color-primary-700);
    font-size: var(--font-size-small);
    font-weight: var(--font-weight-semibold);
    box-shadow: 0 1px 3px rgba(46, 125, 249, 0.08);
}

.article--schedule .schedule__input {
    width: 100%;
}

.article--schedule .schedule__delete {
    min-width: 2.25rem;
    min-height: 2.25rem;
}

@media (max-width: 70rem) {
    .article--schedule .schedule__row {
        grid-template-areas:
            "number day start actions"
            "number day end actions";
        grid-template-columns: minmax(3rem, auto) minmax(10rem, 1fr) minmax(8rem, 1fr) auto;
    }
}

@media (max-width: 50rem) {
    .article--schedule .schedule__row {
        grid-template-areas:
            "number day"
            "start start"
            "end end"
            "actions actions";
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .article--schedule .schedule__cell--number {
        align-items: flex-start;
    }

    .article--schedule .schedule__cell--actions {
        justify-content: flex-start;
    }
}

.article--schedule .schedule__total {
    margin: 0;
    font-weight: var(--font-weight-medium);
    color: var(--color-text-secondary);
}

.article--pedagogy .article__config {
    gap: var(--spacing-4);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: var(--spacing-4);
}

.article--pedagogy .article__config .form {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-4);
    width: 100%;
    max-width: 650px; // Slightly larger to accommodate 600px grid + padding
    pointer-events: auto; // Ensure form allows interaction
}

.article--pedagogy .learning-plane {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-4);
    width: 100%;
    pointer-events: auto; // Ensure container allows interaction
}

.article--pedagogy .article__preview {
    width: clamp(26rem, 35vw, 40rem); // Increased to accommodate larger grid
    max-width: 100%;
    justify-self: stretch;
    padding: var(--spacing-5);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-4);
}

.article--pedagogy .learning-plane__summary {
    display: grid;
    gap: var(--spacing-4);
    padding: var(--spacing-5);
    background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
    border-radius: var(--radius-large);
    border: 1px solid var(--color-neutral-200);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
}

.article--pedagogy .learning-plane__summary-title {
    margin: 0;
    font-size: var(--font-size-extra-large, 24px);
    font-weight: var(--font-weight-bold, 700);
    color: var(--color-primary-700, #1d4ed8);
    letter-spacing: -0.01em;
}

.article--pedagogy .learning-plane__summary-subtitle {
    margin: 0;
    padding: var(--spacing-2) var(--spacing-3);
    background: var(--color-neutral-50);
    border-left: 3px solid var(--color-primary-400);
    border-radius: var(--radius-small);
    color: var(--color-text-secondary);
    font-style: italic;
    font-size: var(--font-size-small);
    line-height: 1.5;
}

.article--pedagogy .learning-plane__summary-description {
    margin: 0;
    padding: var(--spacing-3);
    background: rgba(255, 255, 255, 0.6);
    border-radius: var(--radius-medium);
    color: var(--color-text-primary);
    font-size: var(--font-size-medium);
    line-height: 1.7;
    border: 1px solid var(--color-neutral-100);
}

.article--pedagogy .learning-plane__effects-section {
    display: grid;
    gap: var(--spacing-3);
    padding-top: var(--spacing-4);
    border-top: 2px solid var(--color-neutral-200);
}

.article--pedagogy .learning-plane__effects-title {
    margin: 0;
    font-size: var(--font-size-large, 18px);
    font-weight: var(--font-weight-semibold, 600);
    color: var(--color-text-primary);
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
}

.article--pedagogy .learning-plane__effects-title::before {
    content: "●";
    color: var(--color-primary-500);
    font-size: 1.2em;
}

.article--pedagogy .learning-plane__effects-list {
    display: grid;
    gap: var(--spacing-2);
    margin: 0;
    padding-left: 0;
    list-style: none;
}

.article--pedagogy .learning-plane__effects-list li {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-2);
    padding: var(--spacing-2) var(--spacing-3);
    background: var(--color-background);
    border-left: 2px solid var(--color-primary-200);
    border-radius: var(--radius-small);
    color: var(--color-text-secondary);
    font-size: var(--font-size-small);
    line-height: 1.6;
    transition: all 0.2s ease;
}

.article--pedagogy .learning-plane__effects-list li::before {
    content: "→";
    color: var(--color-primary-500);
    font-weight: var(--font-weight-bold);
    flex-shrink: 0;
    margin-top: 0.1em;
}

.article--pedagogy .learning-plane__effects-list li:hover {
    background: var(--color-primary-50);
    border-left-color: var(--color-primary-400);
    transform: translateX(4px);
}


.curriculum__preview {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-6);
    align-items: stretch;
    padding: clamp(var(--spacing-5), 3vw, var(--spacing-7));
    flex: 1 1 auto;
    min-height: 0;
    max-height: 100%;
    overflow-y: auto;
    overflow-x: hidden;
    overscroll-behavior: contain;
    
    // Prevent scroll jumping
    scroll-behavior: smooth;
    
    // Smooth scrolling and scrollbar styling
    scrollbar-width: thin;
    scrollbar-color: var(--color-neutral-300) transparent;
    
    &::-webkit-scrollbar {
        width: 0.5rem;
    }
    
    &::-webkit-scrollbar-track {
        background: transparent;
    }
    
    &::-webkit-scrollbar-thumb {
        background: var(--color-neutral-300);
        border-radius: var(--radius-small);
    }
    
    &::-webkit-scrollbar-thumb:hover {
        background: var(--color-neutral-400);
    }
}

.curriculum-config__group {
    display: grid;
    gap: var(--spacing-2);
    width: 100%;
    max-width: 100%;
    overflow: hidden;
    padding-bottom: var(--spacing-4);
    border-bottom: 1px solid var(--color-neutral-100);
    
    &:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }
}

// Students article
.article--students {
    grid-template-rows: auto minmax(0, 1fr);
    background: white;

    .students__header {
        width: 100%;
        align-items: flex-start;
        gap: clamp(var(--spacing-2), 1vw, var(--spacing-4));
    }

    .students__heading {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-2);
        max-width: clamp(22rem, 40vw, 32rem);
    }

    .students__subtitle {
        margin: 0;
        color: var(--color-text-secondary);
        font-size: var(--font-size-small);
     
    }

    .students__actions {
        display: flex;
        gap: var(--spacing-6);
      
    }

    .students__options {
        display: flex;
        align-items: center;
        gap: var(--spacing-3);
        flex-wrap: wrap;
    }

    .form--students {
        display: grid;
        gap: var(--spacing-4);
    }

    .students__option {
        display: flex;
        align-items: center;
        gap: var(--spacing-2);
        padding: 0;
        background: transparent;
        border-radius: 0;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;

        &:hover {
            background: transparent;
            border-color: transparent;
        }

        & input[type="radio"] {
            cursor: pointer;
        }

        & span {
            font-size: var(--font-size-medium);
            color: var(--color-text-primary);
            user-select: none;
        }
    }

    .students__config,
    .students__preview {
        display: grid;
        gap: var(--spacing-4);
    }

    .students__section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--spacing-3);
        flex-wrap: wrap;
    }

    .students__section-title {
        margin: 0;
        font-size: var(--font-size-large);
        font-weight: var(--font-weight-semibold);
    }

    .students__description {
        margin: 0;
        color: var(--color-text-secondary);
        line-height: 1.6;
    }

    .students__panels {
        display: grid;
        gap: var(--spacing-4);
        grid-template-columns: repeat(auto-fit, minmax(16rem, 1fr));
    }

    .students__panel {
        display: grid;
        gap: var(--spacing-3);
        padding: clamp(var(--spacing-3), 1.8vw, var(--spacing-4));
        border: 1px solid var(--color-neutral-200);
        border-radius: var(--radius-large);
        background: var(--color-background);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
    }

    .students__panel-title {
        margin: 0;
        font-size: var(--font-size-medium);
        font-weight: var(--font-weight-medium);
    }

    .students__metrics {
        display: grid;
        gap: var(--spacing-2);
        margin: 0;
    }

    .students__metric {
        display: grid;
        gap: var(--spacing-1);
        dt {
            font-size: var(--font-size-small);
            color: var(--color-text-secondary);
        }
        dd {
            margin: 0;
            font-size: var(--font-size-large);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
        }
    }

    .students__status-text {
        margin: 0;
        color: var(--color-text-secondary);
        font-size: var(--font-size-small);
    }

    .students__activity-list {
        display: grid;
        gap: var(--spacing-2);
        margin: 0;
        padding-left: var(--spacing-4);
        color: var(--color-text-secondary);
    }

    .students__activity-item {
        font-size: var(--font-size-small);
        line-height: 1.5;
    }

    .students__feedback {
        padding: var(--spacing-3);
        border-radius: var(--radius-medium);
        border: 1px solid transparent;
        font-size: var(--font-size-small);
    }

    .students__feedback[data-state='warning'] {
        background: var(--color-warning-50);
        border-color: var(--color-warning-200);
        color: var(--color-warning-800);
    }

    .students__feedback[data-state='success'] {
        background: var(--color-success-50);
        border-color: var(--color-success-200);
        color: var(--color-success-700);
    }

    .students__feedback[data-state='error'] {
        background: var(--color-error-50);
        border-color: var(--color-error-200);
        color: var(--color-error-700);
    }

    .students__preview-actions {
        display: flex;
        gap: var(--spacing-2);
        flex-wrap: wrap;
    }

    .students__table-wrapper {
        border: 1px solid var(--color-neutral-200);
        border-radius: var(--radius-large);
        background: white;
        overflow: hidden;
    }

    .students__table {
        width: 100%;
        border-collapse: collapse;
        min-width: 40rem;
    }

    .students__table th,
    .students__table td {
        padding: var(--spacing-2) var(--spacing-3);
        border-bottom: 1px solid var(--color-neutral-100);
        text-align: left;
        vertical-align: top;
        font-size: var(--font-size-small);
    }

    .students__table th {
        background: var(--color-neutral-50);
        font-weight: var(--font-weight-semibold);
        color: var(--color-text-secondary);
    }

    .students__preview-empty td {
        text-align: center;
        color: var(--color-text-tertiary);
        font-style: italic;
    }

    .students__preview-row {
        &:hover {
            background: var(--color-neutral-50);
        }
    }

    .students__preview-cell {
        padding: var(--spacing-1) var(--spacing-2);

        &--editable {
            padding: 0;
        }
    }

    .students__preview-input {
        width: 100%;
        padding: var(--spacing-2) var(--spacing-2);
        border: 1px solid transparent;
        background: transparent;
        font: inherit;
        color: inherit;
        border-radius: 4px;
        transition: all 150ms ease;

        &:focus {
            outline: none;
            background: var(--color-white);
            border-color: var(--color-primary-400);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }

        &:hover:not(:focus) {
            background: var(--color-neutral-50);
            border-color: var(--color-neutral-200);
        }
    }

    .students__preview-delete {
        text-align: center;
        padding: var(--spacing-2) !important;
    }

    .students__preview-delete-btn {
        background: transparent;
        border: 1px solid var(--color-neutral-300);
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 20px;
        line-height: 1;
        cursor: pointer;
        color: var(--color-danger-500);
        transition: all 150ms ease;
        min-width: 32px;
        min-height: 32px;

        &:hover {
            background: var(--color-danger-50);
            border-color: var(--color-danger-300);
            color: var(--color-danger-600);
        }

        &:focus {
            outline: none;
            background: var(--color-danger-50);
            border-color: var(--color-danger-400);
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.1);
        }

        &:active {
            transform: scale(0.95);
        }
    }

    .students__table-delete-col {
        width: 60px;
        text-align: center;
    }
}

.modal--students {
    .modal__content {
        max-width: 720px;
    }
}

.students-upload__form,
.students-manual__form {
    display: grid;
    gap: var(--spacing-4);
}

.students-upload__fieldset,
.students-manual__fieldset {
    border: 1px solid var(--color-neutral-200);
    border-radius: var(--radius-large);
    padding: clamp(var(--spacing-3), 2vw, var(--spacing-4));
    display: grid;
    gap: var(--spacing-3);
    background: var(--color-background);
}

.students-upload__legend,
.students-manual__legend {
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
    font-size: var(--font-size-medium);
    margin-bottom: var(--spacing-2);
}

.students-upload__hint,
.students-manual__bulk-hint {
    margin: 0;
    font-size: var(--font-size-small);
    color: var(--color-text-secondary);
}

.students-upload__actions {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-2);
}

.students-upload__mapping {
    border: 1px dashed var(--color-neutral-300);
    border-radius: var(--radius-large);
    padding: clamp(var(--spacing-3), 2vw, var(--spacing-4));
    display: grid;
    gap: var(--spacing-3);
    background: var(--color-neutral-50);
}

.students-upload__mapping-grid {
    display: grid;
    gap: var(--spacing-2);
    grid-template-columns: repeat(auto-fit, minmax(12rem, 1fr));
}

.students-upload__feedback,
.students-manual__feedback {
    padding: var(--spacing-3);
    border-radius: var(--radius-medium);
    border: 1px solid transparent;
    font-size: var(--font-size-small);
    line-height: 1.5;
}

.students-upload__feedback[data-state='error'],
.students-manual__feedback[data-state='error'] {
    background: var(--color-error-50);
    border-color: var(--color-error-200);
    color: var(--color-error-700);
}

.students-upload__feedback[data-state='success'],
.students-manual__feedback[data-state='success'] {
    background: var(--color-success-50);
    border-color: var(--color-success-200);
    color: var(--color-success-700);
}

.students-upload__status,
.students-manual__status {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    font-size: var(--font-size-small);
    color: var(--color-text-secondary);
}

.students-upload__spinner,
.students-manual__spinner {
    width: 1.25rem;
    height: 1.25rem;
    border-radius: 50%;
    border: 2px solid var(--color-neutral-300);
    border-top-color: var(--color-primary);
    animation: spin 0.8s linear infinite;
}

.students-manual__grid {
    display: grid;
    gap: var(--spacing-3);
    grid-template-columns: repeat(auto-fit, minmax(14rem, 1fr));
}

.students-manual__bulk-input {
    font-family: var(--font-family-monospace, 'SFMono-Regular', Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace);
}

@media (max-width: 48rem) {
    .article--students {
        .students__table {
            min-width: 0;
        }

        .students__table-wrapper {
            overflow-x: auto;
        }
    }
}

.curriculum-config__section-title {
    margin: 0;
    font-size: var(--font-size-small);
    font-weight: 600;
    color: var(--color-text-secondary);
    letter-spacing: 0.025em;
    margin-bottom: var(--spacing-1);
}

// Setting #1: Module Organization
.custom-modules-config {
    display: grid;
    gap: var(--spacing-2);
    padding: var(--spacing-2);
    background: var(--color-neutral-50);
    border-radius: var(--radius-small);
    border: 1px solid var(--color-neutral-200);
}

.custom-modules-list {
    display: grid;
    gap: var(--spacing-2);
}

.custom-module-row {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: var(--spacing-2);
    align-items: center;
    padding: var(--spacing-2);
    background: var(--color-background);
    border-radius: var(--radius-small);
    border: 1px solid var(--color-neutral-200);
}

.custom-module-row__label {
    font-weight: 500;
    font-size: var(--font-size-small);
    color: var(--color-text-secondary);
}

.custom-module-row__input-group {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    font-size: var(--font-size-small);
}

.custom-module-row__input {
    width: 4rem;
    padding: 0.25rem 0.5rem;
    font-size: var(--font-size-small);
}

.custom-module-row__remove {
    color: var(--color-danger-600);
    background: transparent;
    border: none;
    padding: var(--spacing-1);
    cursor: pointer;
    border-radius: var(--radius-small);
    
    &:hover {
        background: var(--color-danger-50);
    }
}

// Setting #2: Content Volume
.curriculum-config__group--content-volume {
    .form__help-text {
        margin-bottom: var(--spacing-2);
        font-size: var(--font-size-small);
        color: var(--color-text-tertiary);
    }
}

// Module Organization Options
.module-organization-options {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--spacing-2);
}

.module-organization-option {
    display: flex;
    gap: var(--spacing-2);
    padding: var(--spacing-2);
    border: 1px solid var(--color-neutral-200);
    border-radius: var(--radius-small);
    background: var(--color-background);
    cursor: pointer;
    transition: all 0.2s ease;
    
    &:hover {
        border-color: var(--color-primary-300);
        background: var(--color-primary-25);
    }
    
    input[type="radio"] {
        margin-top: 0.125rem;
        cursor: pointer;
        flex-shrink: 0;
        width: 1rem;
        height: 1rem;
    }
    
    &:has(input[type="radio"]:checked) {
        border-color: var(--color-primary-500);
        background: var(--color-primary-50);
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.08);
        
        .module-organization-option__name {
            color: var(--color-primary-700);
            font-weight: 600;
        }
    }
}

.module-organization-option__content {
    display: grid;
    gap: var(--spacing-1);
    flex: 1;
}

.module-organization-option__name {
    font-weight: 500;
    font-size: var(--font-size-small);
    color: var(--color-text-primary);
}

.module-organization-option__description {
    font-size: var(--font-size-tiny);
    color: var(--color-text-secondary);
    line-height: 1.4;
}

// Custom Modules Configuration
.custom-modules-config {
    margin-top: var(--spacing-3);
    padding-top: var(--spacing-3);
    border-top: 1px solid var(--color-neutral-200);
    transition: opacity 0.2s ease;
    
    &.disabled {
        opacity: 0.4;
        pointer-events: none;
    }
}

// Content Volume Options
.content-volume-options {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-2);
}

.content-volume-option {
    display: flex;
    gap: var(--spacing-2);
    padding: var(--spacing-2);
    border: 1px solid var(--color-neutral-200);
    border-radius: var(--radius-small);
    background: var(--color-background);
    cursor: pointer;
    transition: all 0.2s ease;
    
    &:hover {
        border-color: var(--color-primary-300);
        background: var(--color-primary-25);
    }
    
    input[type="radio"] {
        margin-top: 0.125rem;
        cursor: pointer;
        flex-shrink: 0;
        width: 1rem;
        height: 1rem;
    }
    
    &:has(input[type="radio"]:checked) {
        border-color: var(--color-primary-500);
        background: var(--color-primary-50);
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.08);
        
        .content-volume-option__name {
            color: var(--color-primary-700);
            font-weight: 600;
        }
    }
}

.content-volume-option__content {
    display: grid;
    gap: var(--spacing-1);
    flex: 1;
}

.content-volume-option__name {
    font-weight: 500;
    font-size: var(--font-size-small);
    color: var(--color-text-primary);
}

.content-volume-option__duration {
    font-family: var(--font-mono, 'Courier New', monospace);
    font-size: var(--font-size-tiny);
    color: var(--color-text-tertiary);
}

.content-volume-option__description {
    font-size: var(--font-size-tiny);
    color: var(--color-text-secondary);
    line-height: 1.4;
}

// Lesson Structure Inputs
.structure-inputs {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--spacing-2);
    
    .form__label {
        margin-bottom: 0;
    }
}

// Course Type
.course-type-options {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-2);
}

.course-type-option {
    display: flex;
    gap: var(--spacing-2);
    padding: var(--spacing-2);
    border: 1px solid var(--color-neutral-200);
    border-radius: var(--radius-small);
    background: var(--color-background);
    cursor: pointer;
    transition: all 0.2s ease;
    
    &:hover {
        border-color: var(--color-primary-300);
        background: var(--color-primary-25);
    }
    
    input[type="radio"] {
        margin-top: 0.125rem;
        cursor: pointer;
        flex-shrink: 0;
        width: 1rem;
        height: 1rem;
    }
    
    input[type="radio"]:checked ~ .course-type-option__content {
        .course-type-option__title {
            color: var(--color-primary-700);
        }
    }
    
    &:has(input[type="radio"]:checked) {
        border-color: var(--color-primary-500);
        background: var(--color-primary-50);
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.08);
    }
}

.course-type-option__content {
    display: grid;
    gap: var(--spacing-1);
    flex: 1;
}

.course-type-option__title {
    font-weight: 600;
    font-size: var(--font-size-small);
    color: var(--color-text-primary);
}

.course-type-option__description {
    font-size: var(--font-size-tiny);
    color: var(--color-text-tertiary);
    line-height: 1.4;
}

.course-type-option__templates {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-1);
    margin: 0;
    padding: 0;
    list-style: none;
    margin-top: var(--spacing-1);
    
    li {
        padding: 0.125rem 0.375rem;
        background: var(--color-neutral-100);
        border-radius: var(--radius-small);
        font-size: 0.65rem;
        color: var(--color-text-tertiary);
        font-weight: 500;
        line-height: 1.4;
    }
}

.course-type-option__note {
    margin: 0;
    font-size: var(--font-size-tiny);
    font-style: italic;
    color: var(--color-text-tertiary);
}

.curriculum-config__group--structure {
    display: grid;
    gap: var(--spacing-2);
    
    h3 {
        font-size: var(--font-size-small);
        font-weight: 600;
        color: var(--color-text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin: 0 0 var(--spacing-1) 0;
    }
    
    .form__help-text {
        font-size: var(--font-size-small);
        color: var(--color-text-tertiary);
        margin-bottom: var(--spacing-2);
    }
    
    .form__label {
        display: grid;
        gap: var(--spacing-1);
        font-size: var(--font-size-small);
        color: var(--color-text-secondary);
    }
    
    .input--number {
        width: 100%;
        max-width: 8rem;
        padding: 0.375rem 0.5rem;
        font-size: var(--font-size-small);
    }
}

@media (max-width: 48rem) {
    .module-organization-options {
        grid-template-columns: 1fr;
    }
    
    .structure-inputs {
        grid-template-columns: 1fr;
    }
    
    .content-volume-options {
        grid-template-columns: 1fr;
    }
    
    .course-type-options {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 32rem) {
    .content-volume-option__duration,
    .content-volume-option__description {
        display: none;
    }
    
    .course-type-option__templates {
        display: none;
    }
}

.curriculum__controls {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-1);
    align-items: center;
    padding: var(--spacing-2) var(--spacing-3);
}

.curriculum__controls .button--outline,
.article--curriculum__config .article .button--outline {
    background: var(--color-background);
    color: var(--color-text-secondary);; 
    border-color: var(--color-neutral-200);
    transition: background 0.2s cubic-bezier(0.4, 0, 0.2, 1), 
                border-color 0.2s cubic-bezier(0.4, 0, 0.2, 1), 
                color 0.2s cubic-bezier(0.4, 0, 0.2, 1),
                transform 0.15s ease;
    
    &:active {
        transform: scale(0.98);
    }
}

.curriculum__controls .button--outline:hover,
.article__config .button--outline:hover {
    background: var(--color-primary-50);
    border-color: var(--color-primary-300);
    color: var(--color-primary-600);
}

.curriculum__controls .button--primary,
.curriculum__controls .button--active,
.article--curriculum .article__config .button--primary {
    box-shadow: 0 0 0 2px rgba(0, 102, 204, 0.18);
    transition: box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.curriculum-config__section-title {
    margin: 0 0 var(--spacing-2);
    font-size: var(--font-size-large);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
}

.curriculum-config__group--templates {
    margin-top: var(--spacing-6);
    padding-top: var(--spacing-6);
    border-top: 1px solid var(--color-neutral-200);
}

.template-placement {
    display: grid;
    gap: var(--spacing-3);
}

.template-placement__empty {
    margin: 0;
    text-align: center;
    font-style: italic;
    color: var(--color-text-tertiary);
}

.template-placement-card {
    --template-accent-surface: var(--color-neutral-25);
    --template-accent-border: var(--color-neutral-200);
    --template-accent-strong: var(--color-text-secondary);
    --template-accent-muted: var(--color-text-tertiary);
    display: grid;
    gap: var(--spacing-3);
    padding: clamp(var(--spacing-3), 1.5vw, var(--spacing-4));
    background: var(--template-accent-surface);
    border: 2px solid var(--template-accent-border);
    border-radius: var(--radius-extra-large);
    box-shadow: var(--shadow-medium);
    transition: border-color 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
    position: relative;
    
    &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 5px;
        height: 100%;
        background: var(--template-accent-border);
        border-radius: var(--radius-extra-large) 0 0 var(--radius-extra-large);
    }
    
    &:hover {
        box-shadow: var(--shadow-large);
    }
}

.template-placement-card--collapsed {
    .template-placement-card__description,
    .template-placement-card__warning,
    .template-placement-card__options,
    .template-placement-card__modules,
    .template-placement-card__lessons {
        display: none;
    }

    .template-placement-card__toggle-icon {
        transform: rotate(-90deg);
    }
}

.template-placement-card--missing {
    --template-accent-surface: rgba(220, 38, 38, 0.06);
    --template-accent-border: rgba(220, 38, 38, 0.24);
    --template-accent-strong: #991b1b;
    --template-accent-muted: #f87171;
}

// Apply accent colors to placement cards
.template-placement-card.template-accent--sky {
    --template-accent-surface: #f0f9ff;
    --template-accent-border: #38bdf8;
    --template-accent-strong: #0369a1;
    --template-accent-muted: #0ea5e9;
}

.template-placement-card.template-accent--violet {
    --template-accent-surface: #f5f3ff;
    --template-accent-border: #c084fc;
    --template-accent-strong: #6b21a8;
    --template-accent-muted: #a855f7;
}

.template-placement-card.template-accent--amber {
    --template-accent-surface: #fefce8;
    --template-accent-border: #fbbf24;
    --template-accent-strong: #b45309;
    --template-accent-muted: #f59e0b;
}

.template-placement-card.template-accent--teal {
    --template-accent-surface: #f0fdfa;
    --template-accent-border: #2dd4bf;
    --template-accent-strong: #0f766e;
    --template-accent-muted: #14b8a6;
}

.template-placement-card.template-accent--rose {
    --template-accent-surface: #fff1f2;
    --template-accent-border: #fb7185;
    --template-accent-strong: #be123c;
    --template-accent-muted: #f43f5e;
}

.template-placement-card.template-accent--slate {
    --template-accent-surface: #f8fafc;
    --template-accent-border: #94a3b8;
    --template-accent-strong: #334155;
    --template-accent-muted: #64748b;
}

.template-placement-card.template-accent--cobalt {
    --template-accent-surface: #eef2ff;
    --template-accent-border: #6366f1;
    --template-accent-strong: #312e81;
    --template-accent-muted: #4f46e5;
}

.template-placement-card.template-accent--mint {
    --template-accent-surface: #ecfdf5;
    --template-accent-border: #34d399;
    --template-accent-strong: #047857;
    --template-accent-muted: #10b981;
}

.template-placement-card.template-accent--sunset {
    --template-accent-surface: #fff7ed;
    --template-accent-border: #fb923c;
    --template-accent-strong: #9a3412;
    --template-accent-muted: #f97316;
}

.template-placement-card.template-accent--gold {
    --template-accent-surface: #fef9c3;
    --template-accent-border: #facc15;
    --template-accent-strong: #854d0e;
    --template-accent-muted: #eab308;
}

.template-placement-card__header {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: var(--spacing-2);
    align-items: start;
}

.template-placement-card__header-content {
    display: grid;
    gap: var(--spacing-2);
}

.template-placement-card__toggle {
    background: none;
    border: none;
    padding: var(--spacing-1);
    cursor: pointer;
    color: var(--template-accent-strong);
    border-radius: var(--radius-small);
    transition: background 0.2s ease, transform 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    flex-shrink: 0;

    &:hover {
        background: rgba(0, 0, 0, 0.05);
    }

    &:focus {
        outline: 2px solid var(--color-primary-300);
        outline-offset: 2px;
    }
}

.template-placement-card__toggle-icon {
    width: 1.25rem;
    height: 1.25rem;
    transition: transform 0.2s ease;
    
    svg {
        width: 100%;
        height: 100%;
        fill: currentColor;
    }
}

.template-placement-card__title {
    margin: 0;
    color: var(--template-accent-strong);
}

.template-placement-card__meta {
    margin: 0;
    font-size: var(--font-size-small);
    color: var(--template-accent-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
}

.template-placement-card__description {
    margin: 0;
    color: var(--color-text-secondary);
    font-size: var(--font-size-small);
}

.template-placement-card__warning {
    margin: 0;
    padding: var(--spacing-2) var(--spacing-3);
    border-radius: var(--radius-small);
    background: rgba(220, 38, 38, 0.1);
    color: #991b1b;
    font-size: var(--font-size-small);
}

.template-placement-card__options {
    display: grid;
    gap: var(--spacing-2);
}

.template-placement-card__option {
    display: flex;
    gap: var(--spacing-2);
    align-items: center;
    color: var(--color-text-secondary);
    font-size: var(--font-size-small);
    padding: var(--spacing-2) var(--spacing-3);
    border-radius: var(--radius-medium);
    cursor: pointer;
    transition: background 0.2s ease, box-shadow 0.2s ease;
}

.template-placement-card__option:hover {
    background: rgba(0, 0, 0, 0.035);
}

.template-placement-card__option:focus-within {
    outline: none;
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.05), inset 0 0 0 1px var(--template-accent-border);
}

.template-placement-card__option input {
    margin: 0;
    pointer-events: none;
    accent-color: var(--color-primary-500);
}

.template-placement-card__option span {
    color: inherit;
}

.template-placement-card__option--active {
    background: var(--color-primary-50);
    color: var(--color-primary-700);
    box-shadow: inset 0 0 0 1px var(--color-primary-200), 0 0 0 2px rgba(0, 102, 204, 0.12);
    font-weight: var(--font-weight-medium);
}

.template-placement-card__option input:disabled + span {
    color: var(--color-text-tertiary);
    opacity: 0.7;
}

.template-placement-card__modules {
    display: grid;
    gap: var(--spacing-2);
    padding: var(--spacing-2) var(--spacing-3);
    background: rgba(255, 255, 255, 0.55);
    border: 1px dashed var(--template-accent-border);
    border-radius: var(--radius-medium);
}

.template-placement-card__modules[hidden] {
    display: none;
}

.template-placement-card__modules-empty,
.template-placement-card__modules-hint {
    margin: 0;
    font-size: var(--font-size-small);
    color: var(--template-accent-muted);
}

.template-placement-card__module {
    display: flex;
    gap: var(--spacing-2);
    align-items: center;
    color: var(--color-text-secondary);
    font-size: var(--font-size-small);
    padding: var(--spacing-2) var(--spacing-3);
    border-radius: var(--radius-medium);
    cursor: pointer;
    transition: background 0.2s ease, box-shadow 0.2s ease;
}

.template-placement-card__module:hover {
    background: rgba(0, 0, 0, 0.035);
}

.template-placement-card__module:focus-within {
    outline: none;
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.05), inset 0 0 0 1px var(--template-accent-border);
}

.template-placement-card__module input {
    margin: 0;
    pointer-events: none;
    accent-color: var(--color-primary-500);
}

.template-placement-card__lessons {
    display: grid;
    gap: var(--spacing-2);
    padding: var(--spacing-2) var(--spacing-3);
    background: rgba(255, 255, 255, 0.55);
    border: 1px dashed var(--template-accent-border);
    border-radius: var(--radius-medium);
}

.template-placement-card__lessons[hidden] {
    display: none;
}

.template-placement-card__lessons-empty,
.template-placement-card__lessons-hint {
    margin: 0;
    font-size: var(--font-size-small);
    color: var(--template-accent-muted);
}

.template-placement-card__lesson {
    display: flex;
    gap: var(--spacing-2);
    align-items: center;
    color: var(--color-text-secondary);
    font-size: var(--font-size-small);
    padding: var(--spacing-2) var(--spacing-3);
    border-radius: var(--radius-medium);
    cursor: pointer;
    transition: background 0.2s ease, box-shadow 0.2s ease;
}

.template-placement-card__lesson:hover {
    background: rgba(0, 0, 0, 0.035);
}

.template-placement-card__lesson:focus-within {
    outline: none;
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.05), inset 0 0 0 1px var(--template-accent-border);
}

.template-placement-card__lesson input {
    margin: 0;
    pointer-events: none;
    accent-color: var(--color-primary-500);
}

.template-placement-card__lesson-content {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-1);
}

.template-placement-card__lesson-title {
    color: inherit;
}

.template-placement-card__lesson-meta {
    font-size: var(--font-size-small);
    color: var(--template-accent-muted);
    opacity: 0.85;
}

.template-placement-card__main-tag {
    display: inline-block;
    margin-left: var(--spacing-2);
    padding: var(--spacing-1) var(--spacing-2);
    background: var(--color-primary-100);
    color: var(--color-primary-700);
    font-size: var(--font-size-small);
    font-weight: var(--font-weight-medium);
    border-radius: var(--radius-small);
    text-transform: lowercase;
}

.template-placement-card__lesson-ranges {
    display: grid;
    gap: var(--spacing-3);
    padding: var(--spacing-2) var(--spacing-3);
    background: rgba(255, 255, 255, 0.55);
    border: 1px dashed var(--template-accent-border);
    border-radius: var(--radius-medium);
}

.template-placement-card__lesson-ranges[hidden] {
    display: none;
}

.template-placement-card__lesson-ranges-hint {
    margin: 0;
    font-size: var(--font-size-small);
    color: var(--template-accent-muted);
}

.template-placement-card__lesson-range {
    display: grid;
    gap: var(--spacing-2);
    padding: var(--spacing-2);
    background: rgba(255, 255, 255, 0.7);
    border-radius: var(--radius-small);
    position: relative;
}

.template-placement-card__lesson-range-inputs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-2);
}

.template-placement-card__lesson-range-input {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-1);

    label {
        font-size: var(--font-size-small);
        font-weight: var(--font-weight-medium);
        color: var(--color-text-secondary);
    }

    input[type="number"] {
        padding: var(--spacing-2);
        border: 1px solid var(--color-neutral-300);
        border-radius: var(--radius-small);
        font-size: var(--font-size-small);
        transition: border-color 0.2s ease, box-shadow 0.2s ease;

        &:focus {
            outline: none;
            border-color: var(--color-primary-500);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        &:hover {
            border-color: var(--color-neutral-400);
        }
    }
}

.template-placement-card__lesson-range-remove {
    position: absolute;
    top: var(--spacing-1);
    right: var(--spacing-1);
    background: rgba(220, 38, 38, 0.1);
    border: none;
    border-radius: var(--radius-small);
    padding: var(--spacing-1);
    cursor: pointer;
    color: #991b1b;
    transition: background 0.2s ease, transform 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 1.75rem;
    height: 1.75rem;

    svg {
        width: 1rem;
        height: 1rem;
        fill: currentColor;
    }

    &:hover {
        background: rgba(220, 38, 38, 0.2);
        transform: scale(1.05);
    }

    &:focus {
        outline: 2px solid #dc2626;
        outline-offset: 2px;
    }
}

.template-placement-card__lesson-range-add {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-2);
    padding: var(--spacing-2) var(--spacing-3);
    background: rgba(0, 102, 204, 0.08);
    border: 1px dashed var(--color-primary-300);
    border-radius: var(--radius-medium);
    color: var(--color-primary-700);
    font-size: var(--font-size-small);
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    transition: background 0.2s ease, border-color 0.2s ease;

    svg {
        width: 1.25rem;
        height: 1.25rem;
        fill: currentColor;
    }

    &:hover {
        background: rgba(0, 102, 204, 0.12);
        border-color: var(--color-primary-400);
    }

    &:focus {
        outline: 2px solid var(--color-primary-500);
        outline-offset: 2px;
    }
}

.template-block {
    --template-accent-surface: var(--color-primary-50);
    --template-accent-border: var(--color-primary-200);
    --template-accent-strong: var(--color-primary-600);
    --template-accent-muted: var(--color-primary-500);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-2);
    padding: var(--spacing-4);
    margin: var(--spacing-4) 0;
    border-radius: var(--radius-large);
    border: 2px solid var(--template-accent-border);
    background: var(--template-accent-surface);
    color: var(--template-accent-strong);
    box-shadow: 
        inset 0 0 0 1px rgba(255, 255, 255, 0.5),
        0 2px 8px rgba(0, 0, 0, 0.08);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    position: relative;
    
    &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 6px;
        height: 100%;
        background: var(--template-accent-strong);
        border-radius: var(--radius-large) 0 0 var(--radius-large);
        opacity: 0.7;
    }
    
    &:hover {
        transform: translateY(-1px);
        box-shadow: 
            inset 0 0 0 1px rgba(255, 255, 255, 0.5),
            0 4px 12px rgba(0, 0, 0, 0.12);
    }
}

.template-block--module {
    border-left-width: 6px;
}

.template-block--lesson {
    margin-left: var(--spacing-4);
    border-left-width: 6px;
}

.template-block--course {
    border: 3px solid var(--template-accent-strong);
    background: linear-gradient(135deg, var(--template-accent-surface) 0%, rgba(255, 255, 255, 0.8) 100%);
    
    &::before {
        width: 8px;
        opacity: 1;
    }
}

.template-block--missing {
    --template-accent-surface: rgba(220, 38, 38, 0.06);
    --template-accent-border: rgba(220, 38, 38, 0.4);
    --template-accent-strong: #991b1b;
    --template-accent-muted: #f87171;
    border-style: dashed;
    opacity: 0.88;
    
    &::before {
        background: repeating-linear-gradient(
            45deg,
            var(--template-accent-strong),
            var(--template-accent-strong) 4px,
            transparent 4px,
            transparent 8px
        );
    }
}

.template-block__content {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-2);
    padding-left: var(--spacing-2);
}

.template-block__name {
    font-weight: var(--font-weight-semibold);
    font-size: var(--font-size-medium);
    margin: 0;
    color: var(--template-accent-strong);
}

.template-block__context {
    margin: 0;
    font-size: var(--font-size-small);
    color: var(--template-accent-muted);
    font-weight: var(--font-weight-medium);
}

.template-block__slug {
    margin: 0;
    font-size: var(--font-size-small);
    color: var(--template-accent-muted);
    opacity: 0.7;
    font-style: italic;
}

.template-accent--sky {
    --template-accent-surface: #e0f2fe;
    --template-accent-border: #38bdf8;
    --template-accent-strong: #0369a1;
    --template-accent-muted: #0ea5e9;
}

.template-accent--violet {
    --template-accent-surface: #ede9fe;
    --template-accent-border: #c084fc;
    --template-accent-strong: #6b21a8;
    --template-accent-muted: #a855f7;
}

.template-accent--amber {
    --template-accent-surface: #fef3c7;
    --template-accent-border: #fbbf24;
    --template-accent-strong: #b45309;
    --template-accent-muted: #f59e0b;
}

.template-accent--teal {
    --template-accent-surface: #ccfbf1;
    --template-accent-border: #2dd4bf;
    --template-accent-strong: #0f766e;
    --template-accent-muted: #14b8a6;
}

.template-accent--rose {
    --template-accent-surface: #ffe4e6;
    --template-accent-border: #fb7185;
    --template-accent-strong: #be123c;
    --template-accent-muted: #f43f5e;
}

.template-accent--slate {
    --template-accent-surface: #e2e8f0;
    --template-accent-border: #94a3b8;
    --template-accent-strong: #334155;
    --template-accent-muted: #64748b;
}

.template-accent--cobalt {
    --template-accent-surface: #e0e7ff;
    --template-accent-border: #6366f1;
    --template-accent-strong: #312e81;
    --template-accent-muted: #4f46e5;
}

.template-accent--mint {
    --template-accent-surface: #d1fae5;
    --template-accent-border: #34d399;
    --template-accent-strong: #047857;
    --template-accent-muted: #10b981;
}

.template-accent--sunset {
    --template-accent-surface: #ffedd5;
    --template-accent-border: #fb923c;
    --template-accent-strong: #9a3412;
    --template-accent-muted: #f97316;
}

.template-accent--gold {
    --template-accent-surface: #fef9c3;
    --template-accent-border: #facc15;
    --template-accent-strong: #854d0e;
    --template-accent-muted: #eab308;
}

// Base editable-surface styles
.editable-surface {
    position: relative;
    min-height: 20rem;
    max-height: 100%;
    width: 100%;
    padding: var(--spacing-4);
    overflow-y: auto;
    overflow-x: hidden;
    overscroll-behavior: contain;
    background: var(--color-background);
    border-radius: var(--radius-large);
    border: 1px solid var(--color-neutral-200);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
    
    // Prevent layout shift during content changes
    contain: layout style;
    
    // Smooth opacity transitions when content loads
    opacity: 1;
    transition: opacity 0.25s ease-in-out;
    
    // Add subtle loading state
    &[data-loading="true"] {
        opacity: 0.6;
        pointer-events: none;
        
        &::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(
                90deg,
                transparent 0%,
                var(--color-primary-400) 50%,
                transparent 100%
            );
            animation: loadingBar 1.5s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }
    }
    
    // Reserve space for content to prevent jumping
    & > * {
        animation: fadeInContent 0.4s cubic-bezier(0.4, 0, 0.2, 1) both;
    }
    
    // Stagger animation for multiple children
    & > *:nth-child(1) { animation-delay: 0ms; }
    & > *:nth-child(2) { animation-delay: 40ms; }
    & > *:nth-child(3) { animation-delay: 80ms; }
    & > *:nth-child(4) { animation-delay: 120ms; }
    & > *:nth-child(5) { animation-delay: 160ms; }
    & > *:nth-child(n+6) { animation-delay: 200ms; }
}

@keyframes loadingBar {
    0% {
        transform: translateX(-100%);
    }
    100% {
        transform: translateX(200%);
    }
}

@keyframes fadeInContent {
    from {
        opacity: 0;
        transform: translateY(-8px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.editable-surface::-webkit-scrollbar {
    width: 0.45rem;
}

.editable-surface::-webkit-scrollbar-track {
    background: transparent;
}

.editable-surface::-webkit-scrollbar-thumb {
    background: var(--color-neutral-300);
    border-radius: var(--radius-small);
}

.editable-surface::-webkit-scrollbar-thumb:hover {
    background: var(--color-neutral-400);
}

.editable-surface:focus-within {
    border-color: var(--color-primary-300);
    box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.12), var(--shadow-medium);
}

.editable-surface:empty {
    display: grid;
    place-items: center;
    text-align: center;
    color: var(--color-text-tertiary);
    min-height: 20rem;
}

.editable-surface:empty::before {
    content: "Configure your curriculum settings to generate a preview.";
    font-size: var(--font-size-small);
    line-height: var(--line-height-relaxed);
    max-width: 32ch;
}

// Lesson Template Selector Styles
.lesson__template-selector {
    display: flex;
    align-items: center;
    gap: var(--spacing-3);
    margin-left: auto;
    padding: 0;
    background: transparent;
    border: none;
}

.lesson__template-label {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-1);
    font-size: 0.85rem;
    font-weight: var(--font-weight-medium);
    color: var(--color-text-tertiary);
    letter-spacing: 0.01em;
    margin: 0;
}

.lesson__template-label-text {
    display: inline-block;
}

.lesson__template-controls {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
}

.lesson__template-dropdown {
    min-width: 10rem;
    font-size: 0.85rem;
    padding: var(--spacing-2) var(--spacing-3);
    border: 1px solid var(--color-neutral-200);
    border-radius: var(--radius-medium);
    background: var(--color-background);
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;

    &:hover {
        border-color: var(--color-primary-400);
    }

    &:focus {
        outline: none;
        border-color: var(--color-primary-500);
        box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.08);
    }
}

.lesson__template-badge {
    padding: var(--spacing-1) var(--spacing-3);
    border-radius: var(--radius-full);
    font-size: 0.75rem;
    font-weight: var(--font-weight-medium);
    text-transform: capitalize;
    white-space: nowrap;
    border: 1px solid var(--template-accent-border);
    background: var(--template-accent-surface);
    color: var(--template-accent-strong);
    box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.5);
}

.editable-surface > .lesson {
    display: grid;
    gap: var(--spacing-5);
    padding: var(--spacing-6);
    border-radius: var(--radius-large);
    border: 1px solid var(--color-neutral-200);
    background: var(--color-background);
    box-shadow: 0 18px 36px -24px rgba(15, 23, 42, 0.35);
    transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    will-change: opacity, transform;
    transform: translateZ(0);
    backface-visibility: hidden;
}

.editable-surface > .lesson + .lesson {
    margin-top: var(--spacing-6);
}

.editable-surface > .lesson:nth-child(even) {
    background: var(--color-neutral-25);
}

.editable-surface > .lesson:hover,
.editable-surface > .lesson:focus-within {
    border-color: var(--color-primary-200);
    box-shadow: 0 22px 40px -24px rgba(15, 23, 42, 0.45);
}

.lesson__header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: var(--spacing-4);
    flex-wrap: wrap;
}

.lesson__title-block {
    display: grid;
    gap: var(--spacing-2);
    align-items: start;
    min-width: 0;
}

.lesson__chip {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-1);
    padding: var(--spacing-1) var(--spacing-3);
    border-radius: var(--radius-full);
    background: var(--color-primary-50);
    color: var(--color-primary-600);
    font-size: 0.8rem;
    font-weight: var(--font-weight-medium);
    letter-spacing: 0.01em;
}

.lesson__title {
    margin: 0;
    font-size: 1rem;
    font-weight: var(--font-weight-medium);
    line-height: 1.5;
    color: var(--color-text-primary);
}

.editable-surface .lesson__meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-3);
    align-items: center;
    margin-top: calc(-1 * var(--spacing-1));
}

.lesson__meta-item {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-1);
    padding: var(--spacing-1) var(--spacing-3);
    border-radius: var(--radius-full);
    background: var(--color-neutral-50);
    color: var(--color-text-secondary);
    font-size: 0.85rem;
    line-height: 1.2;
}

.lesson__meta-item--duration {
    background: var(--color-primary-50);
    color: var(--color-primary-600);
}

.module {
    display: grid;
    gap: var(--spacing-5);
    padding: var(--spacing-6);
    border-radius: var(--radius-large);
    border: 1px solid var(--color-neutral-200);
    background: var(--color-background);
    box-shadow: 0 20px 42px -26px rgba(15, 23, 42, 0.4);
    transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
}

.editable-surface > .module + .module {
    margin-top: var(--spacing-7);
}

.module:nth-child(even) {
    background: var(--color-neutral-25);
}

.module:hover,
.module:focus-within {
    border-color: var(--color-primary-200);
    box-shadow: 0 24px 48px -28px rgba(15, 23, 42, 0.45);
}

.module__header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: var(--spacing-4);
    flex-wrap: wrap;
}

.module__title-block {
    display: grid;
    gap: var(--spacing-2);
    min-width: 0;
}

.module__chip {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-1);
    padding: var(--spacing-1) var(--spacing-4);
    border-radius: var(--radius-full);
    background: var(--color-primary-500);
    color: #fff;
    font-size: 0.8rem;
    font-weight: var(--font-weight-semibold);
    letter-spacing: 0.02em;
    text-transform: uppercase;
}

.module__title {
    margin: 0;
    font-size: 1.1rem;
    font-weight: var(--font-weight-semibold);
    line-height: 1.5;
    color: var(--color-text-primary);
}

.module__meta {
    display: flex;
    align-items: center;
    gap: var(--spacing-3);
    color: var(--color-text-secondary);
    font-size: 0.85rem;
}

.module__meta-item {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-1);
    padding: var(--spacing-1) var(--spacing-3);
    border-radius: var(--radius-full);
    background: var(--color-neutral-50);
}

.module__body {
    display: grid;
    gap: var(--spacing-5);
}

.module__lessons {
    display: grid;
    gap: var(--spacing-4);
}

.module__lessons .lesson {
    display: grid;
    gap: var(--spacing-4);
    padding: var(--spacing-5);
    border-radius: var(--radius-large);
    border: 1px solid var(--color-neutral-200);
    background: var(--color-background);
    box-shadow: 0 12px 24px -20px rgba(15, 23, 42, 0.25);
    transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
}

.module__lessons .lesson:nth-child(even) {
    background: var(--color-neutral-25);
}

.module__lessons .lesson:hover,
.module__lessons .lesson:focus-within {
    border-color: var(--color-primary-200);
    box-shadow: 0 16px 30px -22px rgba(15, 23, 42, 0.3);
}

.module__templates {
    display: grid;
    gap: var(--spacing-3);
    padding-top: var(--spacing-4);
    border-top: 1px dashed var(--color-neutral-200);
}

.editable-surface .topic {
    display: grid;
    gap: var(--spacing-4);
    margin-top: var(--spacing-4);
    padding: var(--spacing-4);
    border-radius: var(--radius-medium);
    border: 1px solid var(--color-neutral-200);
    background: var(--color-neutral-50);
}

.editable-surface .topic:first-of-type {
    margin-top: 0;
}

.topic--simple {
    padding: var(--spacing-3) var(--spacing-4);
}

.topic__title {
    margin: 0;
    font-size: 0.95rem;
    font-weight: var(--font-weight-medium);
    line-height: 1.5;
    color: var(--color-text-secondary);
}

.editable-surface .topic__objectives {
    display: grid;
    gap: var(--spacing-4);
}

.editable-surface .objective-group {
    display: grid;
    gap: var(--spacing-3);
    padding: var(--spacing-3) var(--spacing-4);
    border-radius: var(--radius-medium);
    border: 1px solid var(--color-neutral-200);
    background: var(--color-background);
}

.editable-surface .objective-title {
    display: flex;
    align-items: baseline;
    gap: var(--spacing-2);
}

.editable-surface .objective-text {
    display: block;
    font-size: 0.9rem;
    font-weight: var(--font-weight-medium);
    line-height: 1.5;
    color: var(--color-text-secondary);
}

.editable-surface .objective-tasks {
    margin: 0;
    padding-top: var(--spacing-3);
    border-top: 1px dashed var(--color-neutral-200);
}

.editable-surface .tasks__list {
    margin: 0;
    padding: 0;
    list-style: none;
    display: grid;
    gap: var(--spacing-2);
}

.task-item {
    padding: var(--spacing-2) var(--spacing-3);
    border-radius: var(--radius-medium);
    background: var(--color-neutral-50);
    border: 1px solid transparent;
    font-size: 0.9rem;
    color: var(--color-text-tertiary);
    line-height: 1.5;
    transition: border-color var(--transition-fast), background var(--transition-fast), color var(--transition-fast);
}

.task-item--editable {
    cursor: text;
}

.task-item:hover {
    border-color: var(--color-neutral-200);
    background: var(--color-background);
    color: var(--color-text-secondary);
}

.editable-surface [contenteditable="true"] {
    border: 1px dashed transparent;
    border-radius: var(--radius-medium);
    padding: var(--spacing-2) var(--spacing-3);
    cursor: text;
    outline: none;
    transition: background var(--transition-fast), border-color var(--transition-fast), box-shadow var(--transition-fast);
}

.editable-surface [contenteditable="true"]:hover {
    background: var(--color-neutral-50);
    border-color: var(--color-neutral-200);
}

.editable-surface [contenteditable="true"]:focus {
    background: var(--color-background);
    border-color: var(--color-primary-300);
    box-shadow: 0 0 0 2px rgba(0, 102, 204, 0.12);
}

.editable-surface .lesson__title[contenteditable="true"],
.editable-surface .module__title[contenteditable="true"] {
    padding: 0;
    border-radius: var(--radius-small);
}

.editable-surface [contenteditable="true"]:empty::before {
    content: attr(data-placeholder);
    color: var(--color-text-tertiary);
    pointer-events: none;
}
