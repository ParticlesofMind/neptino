// ==========================================================================
// CARD COMPONENT - BEM Methodology
// ==========================================================================
@use '../abstracts/mixins' as *;

.card {
  // ==========================================================================
  // BLOCK BASE STYLES
  // ==========================================================================
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: var(--spacing-3);
  padding: var(--spacing-3);
  background-color: var(--color-background);
  border-radius: var(--radius-medium);
  border: 1px solid var(--color-neutral-200);
  height: 100%;
  position: relative;

  // CSS Custom Properties for elements
  --card-preview-aspect: 4 / 3;
  --card-preview-padding: 0;
  --card-preview-border-width: 0px;
  --card-preview-border-color: transparent;
  --card-preview-background: transparent;

  // ==========================================================================
  // ELEMENTS
  // ==========================================================================
  &__header {
    grid-row: 1;
    // No margin needed, gap is handled by the grid on .card
  }

  &__body {
    grid-row: 2;
    display: grid;
    grid-auto-flow: row;
    grid-auto-rows: min-content;
    gap: var(--spacing-3);
    align-content: start;
  }

  &__footer {
    grid-row: 3;
    margin-top: auto; // Pushes footer to the bottom
  }

  &__content {
    margin: 0;
  }

  &__title {
    font-weight: var(--font-weight-semibold);
    font-size: var(--font-size-small);
    line-height: 1.3;
    margin: 0;
    word-wrap: break-word;
  }

  &__description {
    font-size: var(--font-size-small);
    color: var(--color-text-secondary);
    line-height: 1.5;
    margin: 0;
  }

  &__preview {
    display: block;
    width: 100%;
    margin-bottom: var(--spacing-2);
    border-radius: var(--radius-small);
    aspect-ratio: var(--card-preview-aspect, 4 / 3);
    border: var(--card-preview-border-width, 0px) solid var(--card-preview-border-color, transparent);
    background-color: var(--card-preview-background, transparent);
    padding: var(--card-preview-padding, 0);
    box-sizing: border-box;
    object-fit: cover;
    overflow: hidden;
  }

  &__preview-note {
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
  }

  &__preview-fallback {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    text-align: center;
    padding: var(--spacing-4);
  }

  &__icon {
    font-size: 2rem;
    line-height: 1;
  }

  &__audio {
    width: 100%;
    margin-top: 0.25rem;
  }

  &__meta {
    display: grid;
    grid-auto-flow: row;
    gap: 0.125rem;
    font-size: 0.6875rem;
    color: var(--color-text-secondary);
    margin: 0;
  }

  &__meta-item {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  &__actions {
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: max-content;
    justify-content: end;
    gap: var(--spacing-2);
    align-items: center;
  }

  &__action {
    min-width: fit-content;
    justify-self: stretch;
  }

  &__info-button {
    // This could be its own .button component variant, but for now, it stays as an element
    border: none;
    background: var(--color-primary-50, #eff6ff);
    color: var(--color-primary-600, #2563eb);
    padding: 0.35rem 0.5rem;
    border-radius: var(--radius-small);
    font-size: var(--font-size-small);
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    display: inline-grid;
    grid-auto-flow: column;
    align-items: center;
    gap: 0.25rem;
    transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease;

    &:hover {
      background: var(--color-primary-100, #dbeafe);
      color: var(--color-primary-700, #1d4ed8);
      transform: translateY(-1px);
    }
  }

  &__close {
    position: absolute;
    top: var(--spacing-4);
    left: var(--spacing-4);
    border: none;
    background: transparent;
    color: var(--color-neutral-600);
    font-size: 1.25rem;
    cursor: pointer;
    padding: 0.25rem;
    border-radius: var(--radius-small);

    &:hover {
      background: var(--color-neutral-100);
      color: var(--color-neutral-800);
    }
  }

  &__status-badge {
    padding: var(--spacing-1) var(--spacing-2);
    border-radius: var(--radius-small);
    font-size: var(--font-size-small);
    font-weight: var(--font-weight-medium);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    background-color: var(--color-neutral-100); // Default background
    color: var(--color-neutral-600); // Default text color
  }

  // ==========================================================================
  // MODIFIERS
  // ==========================================================================
  &--rounded {
    border-radius: var(--radius-large);
  }

  &--elevated {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  &--interactive {
    @include card-hover;
  }

  &--dragging {
    opacity: 0.8;
    transform: rotate(3deg);
    box-shadow: 0 0 0 2px var(--color-primary-200, rgba(59, 130, 246, 0.25));
  }

  &--compact {
    padding: var(--spacing-3);
    gap: var(--spacing-2);
  }

  &--media-info {
    gap: clamp(var(--spacing-3), 4vw, var(--spacing-5));
    width: min(90vw, 840px);
    max-height: 90vh;
    overflow: auto;
    padding: clamp(var(--spacing-4), 5vw, var(--spacing-6));
    box-shadow: 0 20px 45px rgba(15, 23, 42, 0.2);
  }

  // ==========================================================================
  // MODIFIER-SPECIFIC ELEMENT STYLING
  // ==========================================================================

  // Preview Type Modifiers
  &--preview-media {
    .card__preview {
      display: grid;
      place-items: center;
      --card-preview-padding: 1rem;
      --card-preview-border-width: 2px;
      --card-preview-border-color: var(--color-neutral-300);
      --card-preview-background: var(--color-neutral-100);
    }
  }

  &--preview-audio {
    .card__preview {
      --card-preview-border-color: var(--color-warning-300);
      --card-preview-background: var(--color-warning-100);
    }
  }

  &--preview-plugin {
    .card__preview {
      --card-preview-border-color: var(--color-purple-300, #c4b5fd);
      --card-preview-background: var(--color-purple-100, #f3f0ff);
    }
  }

  &--preview-link {
    .card__preview {
      --card-preview-border-color: var(--color-sky-300, #7dd3fc);
      --card-preview-background: var(--color-sky-100, #e0f2fe);
    }
  }

  // Meta Layout Modifier
  &--meta-inline {
    .card__meta {
      grid-auto-flow: column;
      grid-auto-columns: max-content;
      align-items: center;
      gap: var(--spacing-3);
    }
  }

  // Actions Layout Modifier
  &--actions-stacked {
    .card__actions {
      @include grid-responsive(8rem, var(--spacing-1));
      justify-content: start;
    }
  }

  // Compact Modifier Element Styling
  &--compact {
    .card__title {
      font-size: var(--font-size-base);
    }

    .card__content {
      font-size: var(--font-size-small);
    }
  }

  // Status Badge Modifiers
  &--status-draft {
    .card__status-badge {
      background-color: var(--color-warning-100);
      color: var(--color-warning-700);
    }
  }
  &--status-active, &--status-completed {
    .card__status-badge {
      background-color: var(--color-success-100);
      color: var(--color-success-700);
    }
  }
  &--status-archived {
    .card__status-badge {
      background-color: var(--color-neutral-100);
      color: var(--color-neutral-600);
    }
  }

  // ==========================================================================
  // STATES & INTERACTIONS
  // ==========================================================================
  &:focus-within {
    outline: 2px solid var(--color-primary-400);
    outline-offset: 2px;
  }
}