# Copilot Instructions

## Tech Stack
- **Styling:** Sass (SCSS syntax only)
- **Frontend:** TypeScript + HTML
- **Backend:** TypeScript 
- **Database:** PostgreSQL via Docker
- **Testing:** Docker containers only

## Forbidden Language

**NEVER use these words in code, comments, or commit messages:**
- enhanced, improved, optimized, simplified, refactored, updated, fixed, better
- clean, nice, good, great, awesome, perfect
- "this", "it", "stuff", "things" without clear antecedents

**Instead, be specific:**
- ❌ "Enhanced user authentication"
- ✅ "Added 2FA support with TOTP tokens"
- ❌ "Simplified data processing"  
- ✅ "Replaced nested loops with HashMap lookup (O(n) → O(1))"

## Design & Style 

- Never use emojis
- Color consistency and size consistency are crucial
- All colors must use CSS custom properties defined in root
- Font sizes must use a type scale (1.125, 1.25, 1.5, etc.)

## Naming Conventions 

**Forbidden naming patterns:**
- Never use generic names: `data`, `info`, `item`, `thing`, `obj`, `temp`, `new`, `old`
- Never use `enhanced-`, `improved-`, `new-`, `old-` prefixes

**Required patterns:**
- Use BEM (Block, Element, Modifier):
```scss
.block { 
    &__element { 
        &--modifier { 
        }
    }
}
```
- Function names must be verbs: `calculateTax()`, `validateEmail()`, not `taxCalculation()`, `emailValid()`
- Variable names must describe content: `userEmail`, `productPrice`, not `email`, `price`

## Code Structure Requirements

**File organization:**
- 350 lines maximum per file
- If approaching limit: extract pure functions first, then consider splitting by responsibility
- Each file must have a single, clear purpose

**Function requirements:**
- Maximum 20 lines per function
- Maximum 3 parameters (use objects for more)
- Pure functions whenever possible
- No side effects unless explicitly documented
- All functions must have TypeScript type annotations

**Documentation requirements:**
- Every function must have TSDoc with specific examples
- Explain WHY, not WHAT the code does
- Document all assumptions and edge cases
- Include @param and @returns type documentation

## Commit Message Requirements

**Format:** `type(scope): specific action taken`

**Examples:**
- ❌ `fix: improved authentication`
- ✅ `fix(auth): prevent token reuse after logout`
- ❌ `feat: enhanced user experience`  
- ✅ `feat(checkout): add real-time inventory validation`

**Required types:** feat, fix, refactor, test, docs, style, perf, chore

## Refactoring Guidelines

**When to refactor:**
- File exceeds 350 lines AND can be split by clear domain boundaries
- Function has cyclomatic complexity > 10
- Code is duplicated in 3+ places
- Performance bottleneck identified through profiling

**How to refactor:**
- Extract by business logic, not by file type
- Maintain or improve test coverage
- Document breaking changes
- Use dependency injection over global state

## Performance Requirements

- All API calls must have timeout and error handling
- Images must have explicit dimensions
- SCSS must not cause layout shifts (CLS < 0.1)
- TypeScript bundles must be < 250KB gzipped
- Use proper TypeScript types, avoid `any`

## Testing Requirements

**NEVER suggest these commands:**
- `npm run dev` for running tests
- Any Supabase CLI commands for testing
- `npm test` or `yarn test` for backend tests

**ALWAYS use Docker for testing:**
- Backend tests: `docker-compose exec api npm test`
- Database tests: `docker-compose exec db psql -U postgres -d testdb`
- Integration tests: `docker-compose run --rm test-runner`

**Test requirements:**
- Unit tests for all business logic
- Integration tests for API endpoints  
- Visual regression tests for UI components
- Test names must describe behavior: `should return validation error when email format invalid`

## Database Management

**FORBIDDEN database operations:**
- NEVER suggest `DROP DATABASE` or `TRUNCATE` for small changes
- NEVER suggest resetting entire database for schema adjustments
- NEVER suggest `docker-compose down -v` unless explicitly requested

**Required approach for schema changes:**
- Use migrations only: `docker-compose exec api npm run migrate`
- For test data: seed specific tables, not full reset
- For debugging: query specific tables, don't dump entire DB
- For rollbacks: use migration rollback commands

**Examples:**
- ❌ "Let's reset the database to test this change"
- ✅ "Let's run a migration to add this column: `ALTER TABLE users ADD COLUMN...`"
- ❌ "Drop and recreate the users table"
- ✅ "Seed the users table with test data: `INSERT INTO users...`"

## Code Review Blockers

These patterns will be rejected:
- Functions longer than 20 lines
- Missing error handling
- Hardcoded values (use constants/config)
- Console.log statements in production code
- Inline styles (use SCSS classes only)
- Magic numbers
- Unused imports/variables
- TypeScript `any` types (use proper typing)
- CSS instead of SCSS
- Suggesting `npm run dev` for tests
- Suggesting database resets for small changes
- Missing type annotations on functions